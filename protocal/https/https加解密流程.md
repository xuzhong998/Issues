**https**

**https 各端资源准备:**

发送端的数字证书 : 由发送端向公认可信的机构申请, 内容包含 颁发者, 有效期, 公钥, 摘要算法, 摘要, 和签名

接收端的可信机构数字证书 : 同样的内容主要使用里面的公钥

**数字证书申请流程:**

1. 接收端向CA申请证书, 提交材料: 比如网站就时 域名等信息)

2. CA向证书写入**摘要算法, 公钥, 域名等重要信息**

3. CA根据摘要算法, 将证书内容算出 **摘要**

4. CA用私钥对摘要加密, 生成**签名**

5. 将以上信息放入证书中, 颁发给接收端

### 完整的传输过程

下面我们看一下小明再次给小花通信，就和前面的不一样了，我们来看下：

1. 小明把写完的信，在信的底部，附加上摘要算法，假如是 MD5， 以及通过 MD5 算出来的摘要
2. 小明用自己的私钥，对上一步的摘要进行加密，得到签名
3. 小明把摘要算法，摘要，签名都附加到信件底部以后，再把自己的数字证书，一起发送给小花
4. 小花收到信后，首先用自己的 CA 数字证书，拿到 CA 公钥，再用 CA 公钥对数字证书进行验证（也就是上面我们讲的流程）
5. 数字证书验证通过后，说明证书就是 CA 颁发的，没有被篡改
6. 小花就从证书中拿到了小明的公钥
7. 有了小明的公钥，接下来的过程，就是对信件内容进行验证了

对信件内容的验证流程如下（前面其实我们讲过）

1. 小花用小明的公钥，对信件的签名进行解密，得到信件的摘要 D1
2. 小花用摘要算法，对信件进行运算，得到信件的摘要 D2
3. 小花对比 D1 是否等于 D2
4. 如果不相等，说明信件被人篡改过，不安全
5. 如果相等，说明，信件内容没有被篡改过
6. 相等的情况，小花就拿到了信件的内容

总结：

以上所有的内容，是数字证书，加密解密，签名，验签的过程，还没有正式讲 `https` 的过程呢。

有了以上的知识，我们讲起来 https 就容易的多了。下面我们看一张图



我们以访问 `www.helloworld.net` 网站为例，讲解 https 的过程

此过程分为 3 个阶段，我们在下面描述此 3 个阶段

**访问 `www.helloworld.net` 的过程** 阶段如下

- 网站申请证书阶段
  1. 网站向 CA 机构申请数字证书（需要提交一些材料，比如域名）
  2. CA 向证书中写入摘要算法，域名，网站的公钥等重要信息
  3. CA 根据证书中写入的摘要算法，计算出证书的摘要
  4. CA 用自己的私钥对摘要进行加密，计算出签名
  5. CA 生成一张数字证书，颁发给了 `www.helloworld.net`
  6. 网站的管理员，把证书放在自己的服务器上
- 浏览器验证证书阶段
  1. 浏览器在地址栏中输入 `https://www.helloworld.net`，并回车
  2. 服务器将数字证书发送给浏览器
  3. 浏览器用操作系统内置的 CA 的数字证书，拿到 CA 的公钥
  4. 浏览器用 CA 公钥对 www.helloworld.net 的数字证书进行验签
  5. 具体就是，浏览器用 CA 公钥，对 helloworld 的数字证书中的签名进行解密，得到摘要 D1
  6. 浏览器根据 helloworld 数字证书中的摘要算法，计算出证书的摘要 D2
  7. 对比 D1 和 D2 是否相等。
  8. 如果不相等，说明证书被掉包了
  9. 如果相等，说明证书验证通过了。
- 协商对称加密密钥阶段
  1. 浏览器验证数字证书通过以后
  2. 浏览器拿到数字证书中的公钥，也就是 `www.helloworld.net` 网站的公钥
  3. 浏览器有了网站的公钥后，就用公钥进行对`密钥S` 进行加密，加密以后的密文发送给服务器
  4. 服务器收到密文后，用自己的私钥进行解密，得到`密钥S`
  5. 此后浏览器，服务器双方就用`密钥S` 进行对称加密的通信了。

终止所述，终于讲完了，花了整整一天的时间

过程那么多，其实抓住几个关键的问题是很简单的，本质上还是两个人，如何安全高效的进行通信

我们再次简单的总结一下，采用一问一答的方式，我觉得比较好

问题一：小明和小花安全的通信，怎么做？

答：通过加密

问题二：通过哪种加密方式通信，更高效？

答：对称加密

 因为，单向加密，没办法解密，不行

 非对称加密，太慢，也不行

 只有对称加密，速度快

问题三：采用对称加密，密钥 S 怎么安全传输？

答：小花使用小明的公钥，对`密钥S` 进行加密，传给小明

 小明用自己的私钥解密

问题四：小明如何安全的把自己的公钥传输给小花？

答：使用数字证书

 具体就是 小明向 CA 申请一个自己的数字证书，把自己的公钥放在证书中

 小明将数字证书发送给小花

问题五：小花如何验证数字证书的真实性？

答：小花用操作系统内置的 CA 的数字证书，拿到 CA 的公钥，用 CA 的公钥，对数字证书进行验签

验签通过，说明数字证书是真的。
